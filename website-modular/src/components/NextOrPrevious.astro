---
import { extractFrontMatter } from '../utils/docs';
import {
    docsPath,
    exists,
    join,
    readFile,
    removeMdExtensionFromFile,
    root,
} from '../utils/paths';
import ButtonLink from './ButtonLink.astro';

interface Props {
    next?: string;
    previous?: string;
}

const { next, previous } = Astro.props;

let nextPath: string | undefined;
let nextTitle: string | undefined;
if (next) {
    nextPath =
        next?.split('/').length === 1 ? join(root, 'index.md') : docsPath(next);
    if (exists(nextPath)) {
        let file = readFile(nextPath);
        file = removeMdExtensionFromFile(file);
        const { frontMatter } = extractFrontMatter(file);
        nextTitle = frontMatter?.title ?? next;
    }
}

let previousPath: string | undefined;
let previousTitle: string | undefined;
if (previous) {
    previousPath =
        previous?.split('/').length === 1
            ? join(root, 'index.md')
            : docsPath(previous);
    if (exists(previousPath)) {
        let file = readFile(previousPath);
        file = removeMdExtensionFromFile(file);
        const { frontMatter } = extractFrontMatter(file);
        previousTitle = frontMatter?.title ?? previous;
    }
}
---

{
    (next || previous) && (
        <div class="flex justify-between space-x-4 py-4">
            {previous && (
                <ButtonLink href={`/docs${previous}`}>
                    Previous: {previousTitle}
                </ButtonLink>
            )}
            {next && (
                <ButtonLink href={`/docs${next}`}>Next: {nextTitle}</ButtonLink>
            )}
        </div>
    )
}
